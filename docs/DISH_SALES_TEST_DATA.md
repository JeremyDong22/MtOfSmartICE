# 菜品综合统计爬虫 - 测试数据和设计

## 页面信息

**URL**: `https://pos.meituan.com/web/report/dishSaleAnalysis#/rms-report/dishSaleAnalysis`

**导航路径**: 报表中心 → 菜品报表 → 菜品综合统计

## 关键设置

1. **营业日期**: 2026/01/19 至 2026/01/20
2. **同名菜品合并统计**: ✅ 已勾选
3. **按门店统计**: ✅ 已勾选 (关键！这样可以一次获取所有门店数据)
4. **销售方式**: 单品+套餐明细 (这样套餐会被拆分成单品)

## 测试数据样本 (从页面截取)

### 第1行
- 序号: 1
- 门店: 野百灵·贵州酸汤（绵阳上马店）
- 机构编码: MD00012
- 菜品名称: 非遗手工蘸料
- 销售数量: 146
- 销量数量占比: 2.79%
- 折前均价（元）: 4.70
- 折后均价（元）: 4.58
- 销售额(元): 685.54
- 销售额占比: 0.91%
- 优惠金额(元): 16.95
- 菜品优惠占比: 0.31%
- 菜品收入(元): 668.59
- 菜品收入占比: 0.96%
- 点菜数量: 152
- 点菜金额（元）: 715.54
- 退菜数量: 6
- 退菜金额（元）: 30.00
- 退菜数量占比: 3.51%
- 退菜金额占比: 1.62%
- 退菜率: 3.95%
- 退菜订单量: 2
- 赠菜数量: 0
- 赠菜金额（元）: 0.00
- 赠菜数量占比: 0.00%
- 赠菜金额占比: 0.00%
- 菜品销售订单量: 45
- 关联订单金额: 17,638.00
- 菜品销售千次: 608.33
- 菜品点单率: 18.75%
- 顾客点击率: 21.76%

### 第2行
- 序号: 2
- 门店: 野百灵·贵州酸汤火锅（德阳店）
- 机构编码: MD00010
- 菜品名称: 非遗手工蘸料
- 销售数量: 93
- (其他字段类似...)

### 第3行
- 序号: 3
- 门店: 宁桂杏山野烤肉（上马店）
- 机构编码: MD00009
- 菜品名称: 风味小料
- 销售数量: 84
- (其他字段类似...)

## 数据统计

- **总记录数**: 515条
- **总页数**: 26页
- **每页记录数**: 20条

## 表格列结构 (共30+列)

1. 序号
2. 门店
3. 机构编码
4. 菜品名称
5. 销售数量
6. 销量数量占比
7. 折前均价（元）
8. 折后均价（元）
9. 销售额(元)
10. 销售额占比
11. 优惠金额(元)
12. 菜品优惠占比
13. 菜品收入(元)
14. 菜品收入占比
15. 点菜数量
16. 点菜金额（元）
17. 退菜数量
18. 退菜金额（元）
19. 退菜数量占比
20. 退菜金额占比
21. 退菜率
22. 退菜订单量
23. 赠菜数量
24. 赠菜金额（元）
25. 赠菜数量占比
26. 赠菜金额占比
27. 菜品销售订单量
28. 关联订单金额
29. 菜品销售千次
30. 菜品点单率
31. 顾客点击率

## 数据特点

1. **按门店分组**: 每行包含门店信息，不需要逐个选择门店
2. **包含org_code**: 可以直接映射到Supabase的restaurant_id
3. **数据在主页面**: 不在iframe中
4. **需要翻页**: 26页数据需要遍历提取

## 与现有爬虫的对比

| 特性 | equity_package_sales | business_summary | dish_sales (新) |
|------|---------------------|------------------|----------------|
| 数据位置 | iframe (crm-smart) | iframe (dpaas-report) | 主页面 |
| 门店选择 | 集团账号 | 集团账号 | 按门店统计勾选 |
| 数据分组 | 按门店+日期 | 按门店+日期 | 按门店+日期+菜品 |
| 翻页 | 是 | 是 | 是 |

## 爬虫实现要点

1. **导航**: 需要导航到正确URL并确保勾选"按门店统计"
2. **日期设置**: 使用现有的日期设置逻辑
3. **数据提取**: 从主页面表格提取，不需要处理iframe
4. **翻页**: 遍历26页数据
5. **数据映射**: org_code → restaurant_id (通过master_restaurant表)

## 数据库设计

基于实际字段，数据库表应包含：
- 基础信息: store_name, org_code, business_date, dish_name
- 销售数据: sales_quantity, sales_amount, discount_amount, dish_income
- 点菜数据: order_quantity, order_amount
- 退菜数据: return_quantity, return_amount, return_rate
- 赠菜数据: gift_quantity, gift_amount
- 统计数据: order_count, related_order_amount, sales_per_thousand, order_rate, customer_click_rate
